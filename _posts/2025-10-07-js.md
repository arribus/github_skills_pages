---
title: "First javascript using github pages"
date: 2025-10-07
layout: post
---

In this post I translated a small Python script that talks to the Radio France GraphQL API into JavaScript. IMPORTANT: for security I strongly recommend storing your API key only in Netlify environment variables and never committing it, even in a `.env` file.

This repository provides a Netlify serverless function that proxies requests to the Radio France GraphQL API. The client-side code (served from GitHub Pages) should call the serverless function — the function injects the `API_KEY` from Netlify environment variables so the key never appears in client-side code or your repo.

Files added

- `netlify/functions/radiofrance.js` — Netlify serverless function which proxies GraphQL requests and reads `API_KEY` from Netlify environment variables.

Netlify-only API key workflow (recommended)

1. Deploy this site to Netlify (connect the GitHub repo).
2. In Netlify site settings -> Build & deploy -> Environment, add a variable named `API_KEY` with the secret value.
3. From client-side JS (GitHub Pages), call the function — the function is available at `/.netlify/functions/radiofrance` and accepts the same GraphQL POST body as the upstream API. Example client call:

```js
fetch('/.netlify/functions/radiofrance', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ query: '{ brands { id title } }' })
}).then(r => r.json()).then(console.log)
```

Security and notes

- Do NOT add the API key to the repository. Do NOT rely on a checked-in `.env` file. Use Netlify environment variables only for production.
- Locally you can test by setting the environment variable in your shell (do not commit any secrets). Example (PowerShell):

```powershell
$env:API_KEY='your-secret-key'
node .\scripts\radiofrance_cli.js
```

- The Netlify serverless function currently proxies requests and forwards the `x-token` header using the `API_KEY`. If you expose it publicly, consider adding request validation, rate-limiting, or access control to the function.

If you want, I can add a minimal client page (HTML + JS) to call the Netlify function and display results on your site; that will keep the API key secure in Netlify while enabling a nice UI on GitHub Pages.

I added a simple demo you can host on GitHub Pages or open locally: `demo/radio-demo.html`. Steps:

1. Deploy the site to Netlify and set the `API_KEY` environment variable in Netlify settings.
2. Note your Netlify function URL (for example: `https://harmonious-banoffee-8d5c15.netlify.app/.netlify/functions/radiofrance`).
3. Host `demo/radio-demo.html` on GitHub Pages or open the file locally in a browser and paste the function URL into the input field. Click "Run query" to see results.

The demo calls the Netlify function, so the API key is never exposed in the demo page or repository.

Interactive demo (embed)

Below is a small interactive demo you can use directly in this blog post. When this post is rendered by Jekyll on GitHub Pages it will show a simple UI that calls the Netlify function. Make sure the Netlify function URL is set below (or replace it with your published function URL).

<div id="radio-demo">
  <label>Netlify function URL:</label>
  <input id="fnUrl_post" value="https://harmonious-banoffee-8d5c15.netlify.app/.netlify/functions/radiofrance" style="width:100%" />
  <br/><br/>
  <label>Query</label>
  <textarea id="query_post" style="width:100%;height:120px">{ brands { id title } }</textarea>
  <p>
    <button id="run_post">Run query</button>
  </p>
  <pre id="out_post">(no result yet)</pre>

  <hr />
  <h3>WebRadios for a brand</h3>
  <label>Brand ID (e.g. FIP):</label>
  <input id="brand_post" value="FIP" style="width:100%" />
  <p>
    <button id="run_webradios">Fetch webRadios</button>
  </p>
  <pre id="out_webradios">(no result yet)</pre>

  <hr />
  <h3>Track info for a webRadio</h3>
  <label>webRadio ID (e.g. FIP):</label>
  <input id="radio_post" placeholder="Enter webRadio ID" style="width:100%" />
  <p>
    <button id="run_track">Fetch track info</button>
  </p>
  <pre id="out_track">(no result yet)</pre>
</div>

<script>
  (function(){
    const fnUrl = () => document.getElementById('fnUrl_post').value.trim();

    async function callFn(query) {
      const url = fnUrl();
      if (!url) return alert('Enter your Netlify function URL');
      const res = await fetch(url, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ query }) });
      const text = await res.text();
      try { return JSON.parse(text); } catch { return text; }
    }

    // brands
    const out = document.getElementById('out_post');
    document.getElementById('run_post').addEventListener('click', async () => {
      const query = document.getElementById('query_post').value;
      out.textContent = 'Loading...';
      try {
        const data = await callFn(query);
        out.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
      } catch (err) { out.textContent = 'Error: ' + err }
    });

    // webradios
    const outWeb = document.getElementById('out_webradios');
    document.getElementById('run_webradios').addEventListener('click', async () => {
      const brand = document.getElementById('brand_post').value.trim();
      if (!brand) return alert('Enter a brand ID');
      const query = `\n{\n  brand(id: ${brand}) {\n    id\n    title\n    localRadios { id title }\n    webRadios { id title }\n  }\n}\n`;
      outWeb.textContent = 'Loading...';
      try {
        const data = await callFn(query);
        outWeb.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
      } catch (err) { outWeb.textContent = 'Error: ' + err }
    });

    // track info
    const outTrack = document.getElementById('out_track');
    document.getElementById('run_track').addEventListener('click', async () => {
      const radio = document.getElementById('radio_post').value.trim();
      if (!radio) return alert('Enter a webRadio ID');
      const query = `\n{\n  live(station: ${radio}) {\n    song {\n      track {\n        id\n        title\n        albumTitle\n        label\n        mainArtists\n        authors\n        composers\n        performers\n        productionDate\n        discNumber\n        trackNumber\n      }\n    }\n  }\n}\n`;
      outTrack.textContent = 'Loading...';
      try {
        const data = await callFn(query);
        outTrack.textContent = typeof data === 'string' ? data : JSON.stringify(data, null, 2);
      } catch (err) { outTrack.textContent = 'Error: ' + err }
    });
  })();
</script>
Title: "First javascript using github pages"
Date: 2025-01-07

In this post I translated a small Python script that talks to the Radio France GraphQL API into JavaScript. IMPORTANT: for security I strongly recommend storing your API key only in Netlify environment variables and never committing it, even in a `.env` file.

This repository provides a Netlify serverless function that proxies requests to the Radio France GraphQL API. The client-side code (served from GitHub Pages) should call the serverless function — the function injects the `API_KEY` from Netlify environment variables so the key never appears in client-side code or your repo.

Files added

- `netlify/functions/radiofrance.js` — Netlify serverless function which proxies GraphQL requests and reads `API_KEY` from Netlify environment variables.

Netlify-only API key workflow (recommended)

1. Deploy this site to Netlify (connect the GitHub repo).
2. In Netlify site settings -> Build & deploy -> Environment, add a variable named `API_KEY` with the secret value.
3. From client-side JS (GitHub Pages), call the function — the function is available at `/.netlify/functions/radiofrance` and accepts the same GraphQL POST body as the upstream API. Example client call:

```js
fetch('/.netlify/functions/radiofrance', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ query: '{ brands { id title } }' })
}).then(r => r.json()).then(console.log)
```

Security and notes

- Do NOT add the API key to the repository. Do NOT rely on a checked-in `.env` file. Use Netlify environment variables only for production.
- Locally you can test by setting the environment variable in your shell (do not commit any secrets). Example (PowerShell):

```powershell
$env:API_KEY='your-secret-key'
node .\scripts\radiofrance_cli.js
```

- The Netlify serverless function currently proxies requests and forwards the `x-token` header using the `API_KEY`. If you expose it publicly, consider adding request validation, rate-limiting, or access control to the function.

If you want, I can add a minimal client page (HTML + JS) to call the Netlify function and display results on your site; that will keep the API key secure in Netlify while enabling a nice UI on GitHub Pages.

I added a simple demo you can host on GitHub Pages or open locally: `demo/radio-demo.html`. Steps:

1. Deploy the site to Netlify and set the `API_KEY` environment variable in Netlify settings.
2. Note your Netlify function URL (for example: `https://harmonious-banoffee-8d5c15.netlify.app/.netlify/functions/radiofrance`).
3. Host `demo/radio-demo.html` on GitHub Pages or open the file locally in a browser and paste the function URL into the input field. Click "Run query" to see results.

The demo calls the Netlify function, so the API key is never exposed in the demo page or repository.

Interactive demo (embed)

Below is a small interactive demo you can use directly in this blog post. When this post is rendered by Jekyll on GitHub Pages it will show a simple UI that calls the Netlify function. Make sure the Netlify function URL is set below (or replace it with your published function URL).

<div id="radio-demo">
  <label>Netlify function URL:</label>
  <input id="fnUrl_post" value="https://harmonious-banoffee-8d5c15.netlify.app/.netlify/functions/radiofrance" style="width:100%" />
  <br/><br/>
  <label>Query</label>
  <textarea id="query_post" style="width:100%;height:120px">{ brands { id title } }</textarea>
  <p>
    <button id="run_post">Run query</button>
  </p>
  <pre id="out_post">(no result yet)</pre>
</div>

<script>
  (function(){
    const out = document.getElementById('out_post');
    document.getElementById('run_post').addEventListener('click', async () => {
      const url = document.getElementById('fnUrl_post').value.trim();
      if (!url) return alert('Enter your Netlify function URL');
      const query = document.getElementById('query_post').value;
      out.textContent = 'Loading...';
      try {
        const res = await fetch(url, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ query }) });
        const text = await res.text();
        try { out.textContent = JSON.stringify(JSON.parse(text), null, 2); } catch(e) { out.textContent = text }
      } catch (err) {
        out.textContent = 'Error: ' + err;
      }
    });
  })();
</script>